<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}–ú–∞–≥–∞–∑–∏–Ω{% endblock %}</title>
    
    <!-- Tailwind CSS (–ø—Ä–∏–º–µ—Ä) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    
    <!-- Alpine.js –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    {% block extra_css %}{% endblock %}
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <!-- –õ–æ–≥–æ—Ç–∏–ø -->
                <div class="flex items-center space-x-8">
                    <a href="/" 
                       class="text-xl font-bold text-gray-800"
                       hx-get="/"
                       hx-target="#main-content"
                       hx-push-url="true">
                        –ú–∞–≥–∞–∑–∏–Ω
                    </a>
                    
                    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º -->
                    <nav class="hidden md:flex space-x-6">
                        {% for category in categories %}
                        <a href="{% url 'catalog' category.slug %}"
                           class="text-gray-600 hover:text-gray-900 {% if current_category == category.slug %}text-blue-600 font-medium{% endif %}"
                           hx-get="{% url 'catalog' category.slug %}"
                           hx-target="#main-content"
                           hx-push-url="true">
                            {{ category.name }}
                        </a>
                        {% endfor %}
                    </nav>
                </div>

                <!-- –ü–æ–∏—Å–∫ –∏ –¥–µ–π—Å—Ç–≤–∏—è -->
                <div class="flex items-center space-x-4">
                    <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–∏—Å–∫–∞ -->
                    <button class="p-2 text-gray-600 hover:text-gray-900"
                            hx-get="/catalog/?show_search=true"
                            hx-target="#search-container">
                        üîç
                    </button>
                    
                    <!-- –ö–æ—Ä–∑–∏–Ω–∞ –∏ –¥—Ä. —ç–ª–µ–º–µ–Ω—Ç—ã -->
                    <div class="flex items-center space-x-2">
                        <a href="#" class="p-2 text-gray-600 hover:text-gray-900">üõí</a>
                        <a href="#" class="p-2 text-gray-600 hover:text-gray-900">üë§</a>
                    </div>
                </div>
            </div>
            
            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø–æ–∏—Å–∫–∞ -->
            <div id="search-container">
                {% if show_search %}
                    {% include 'main/search_input.html' %}
                {% else %}
                    {% include 'main/search_button.html' %}
                {% endif %}
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div id="main-content">
            {% block content %}
            <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å—Å—è –∫–æ–Ω—Ç–µ–Ω—Ç —á–µ—Ä–µ–∑ HTMX -->
            {% endblock %}
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-12">
        <div class="container mx-auto px-4 py-8">
            <div class="text-center">
                <p>&copy; 2024 –ú–∞–≥–∞–∑–∏–Ω. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            </div>
        </div>
    </footer>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
    <div id="filter-modal" 
         x-data="{ open: false }" 
         x-show="open" 
         x-cloak
         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg max-w-md w-full mx-4" 
             @click.away="open = false">
            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ HTMX -->
        </div>
    </div>

    {% block extra_js %}{% endblock %}

    <script>
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏ HTMX
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Alpine.js –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
            document.addEventListener('click', function(e) {
                if (e.target.hasAttribute('hx-get')) {
                    const url = e.target.getAttribute('hx-get');
                    if (url.includes('show_filters=true')) {
                        const modal = document.querySelector('#filter-modal [x-data]');
                        if (modal) {
                            modal.__x.$data.open = true;
                        }
                    }
                }
            });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω—ã—Ö HTMX –∑–∞–ø—Ä–æ—Å–æ–≤
            document.body.addEventListener('htmx:afterSwap', function(event) {
                // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
                if (event.detail.target.id === 'main-content') {
                    const modal = document.querySelector('#filter-modal [x-data]');
                    if (modal && modal.__x) {
                        modal.__x.$data.open = false;
                    }
                }
            });
        });
    </script>

    <style>
        [x-cloak] { display: none !important; }
    </style>
</body>
</html>